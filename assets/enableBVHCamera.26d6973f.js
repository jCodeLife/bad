import{e as P,c as V,l as f,v as C,b as i,a as h,d as v,f as _,s as m,q as R}from"./index.3bc64a20.js";import{g as b}from"./useBVHMap.56f01d8b.js";const p=new Set,[g,T]=P();V(function(){const t=b();if(!t.length){const e=f(g);return()=>{e.cancel()}}const o=f(()=>{g();for(const e of p){e.updateMatrixWorld();const c=e.getWorldDirection(C),{start:a,end:s}=h;s.copy(a.copy(e.position)),i.makeEmpty(),i.expandByPoint(a),i.min.addScalar(-.5),i.max.addScalar(.5);const S=v,x=_;let r=0,d=0;for(const B of t)B.shapecast({intersectsBounds:u=>u.intersectsBox(i),intersectsTriangle:u=>{r=u.closestPointToSegment(h,S,x),r<.5&&(d=.5-r,a.addScaledVector(c,d),s.addScaledVector(c,d))}});const l=a.sub(e.position),y=Math.max(0,l.length()-1e-5);l.normalize().multiplyScalar(y),e.position.add(l)}});return()=>{o.cancel()}},[b]);function W(t){var o;this._target&&this._target._visible===void 0&&(this._target.outerObject3d.visible=t);for(const e of this.camera.children)((o=e.userData.manager)===null||o===void 0?void 0:o._visible)===void 0&&(e.visible=t)}function M(){if(this.done)return;const t=this.camera;m.attach(t),p.add(t),this.then(()=>{m.remove(t),p.delete(t)});let o=!1;this.watch(T(()=>{const e=this.outerObject3d.getWorldPosition(v),n=this.object3d.getWorldPosition(_),c=n.distanceTo(e);t.position.lerp(n,.1);const a=t.position.distanceTo(e)/c;t.position.lerpVectors(e,n,a),t.quaternion.copy(this.object3d.getWorldQuaternion(R));const s=a<.35;s!==o&&W.call(this,!s),o=s}))}export{M as default};
